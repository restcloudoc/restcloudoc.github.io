上次修改时间: {docsify-updated}

# API组件

本节主要用于介绍 RestCloud 中 API组件 相关的内容  
没有提及的部分大概率是不重要的  

# 模拟数据组件
## 基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称

* 模拟数据选择  
点击右边的 `新增` 即可添加新的模拟数据。  
然后 `配置名称` 填写该相应数据的描述， `模拟数据` 中填写需要使用的固定JSON数据。  
然后点 `提交` 即可。  
如果 **需要修改** 该模拟数据，需要在 首页 =》 服务集成中心 =》 API开发 中创建与在 `API编排` 里相同 `应用Id` 的应用，然后进入该应用，点击 `模拟数据` 图标，找到相应 `配置名称` 的模拟数据，点击 `编辑` 即可修改。  

* HTTP响应码  
用于指定该数据代表的一些服务器的状态。  

* 结果转换为JSON  
选择 是 则结果解析为 JSON ，选择 否 则结果以 字符串 进行解析。  

## 节点总结
该节点主要用于一些固定的 JSON 数据的存储，例如 `固定响应文本`，`固定常用变量`等  
 
-------------------------

# 变量设置组件
## 基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称

* 变量类型  
可以保留默认的 `全局变量`，用于保证后边的节点都可以使用该变量。  

## 变量设置
点击 `新增变量` 后，可以进行相关变量的设置。  

* 变量Id  
用于设置该变量的 名称 ，可供 下一节点 或 全局节点 进行使用

* 变量值  
可以使用 固定值（如 Hello） ，也可以使用 变量  
变量形式 可参考 [获取变量的方式](/modules/arrange#获取变量的方式)

* 类型  
用于指定该变量的类型

* 绑定数据转换或生成规则  
有时候我们需要的变量形式比较复杂，直接在这里进行赋值的话无法满足要求，就可以使用该功能。**（可以不使用）**  
这个功能会传入 `参数（http请求，上一节点的数据等）` 到一个 `java规则` 中。  
`java规则` 可以由我们自己来进行编写，规则编写过程可[点击查看](/scripts/java#规则编写)。  

* 规则参数  
用于指定 `绑定数据转换或生成规则` 中规则在 `indoc` 中传出的变量。**（可以不使用）**   

上边的所有部分都设置完成后，点击 `保存` 即可

## 节点总结  
1. 用于将相关数据设置为固定字段的变量。可以  
    1. 防止前置请求的字段名称改变，从而影响后边流程的变量的使用。
    2. 可以将变量信息供全局范围内使用。  

-------------------------

# RestfulAPI组件
## 基础配置的基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称  

* 节点别名  
当请求 API 后，返回的数据可以放到该别名节点中

* 输出结果  
设置为 `不输出API结果` ，那么该结果不会在最后的响应体中输出，仅供后边节点使用。  
设置为 `输出API结果给调用端` ，那么该结果会在最后的响应体中输出。  

## 基础配置的API配置
* API URL  
用于设置 `请求API` 的 `URL`  
可以使用 `固定的API链接` ，也可以使用变量形式，如 `${#config.esb.gatewayurl}` ，# 不可以丢。  

* 参数传递方式  
用于指定是 Form表单 Body请求体 还是 Body请求（直接输入请求体JSON） 形式。  

* 追加认证头  
选择 是 可以自动添加 identitytoken 到 请求头 中  

* 异步调用  
选择 是 则 API调用结果 无法在后续结点中使用。  

* 请求读取超时  
如果 API 调用的时间过长，设置多长时间后将不再等待。  

## 基础配置的测试
* header参数  
可以添加 请求 需要的相关 请求头。  

* 请求参数类型  
根据 API 类型选择 Form 形式还是 RequestBody 形式。  
Form 需要一个一个参数的添加。  
RequestBody 可以直接输入 JSON 数据。  

设置完后，点击 `开始测试` ，则会返回 API 调用结果。  

## 高级配置的基本属性
* 保存请求参数  
数据量较大时选择 否 即可。  

* 保存响应结果  
数据量较大时选择 否 即可。  

## 高级配置的API配置
* 网络链接超时  
与 API 建立连接的 超时时间  

## 高级配置的Header
点击 `添加Header头` ，下边会出来一行新的值。以下为相关值的解释。  

* 透传Header: 选择该项就是当有相同名称 请求头 时，原样进行传输
* Header: 请求头的名称
* 缺省值: 可以填写 `固定值`，也可以使用变量，例如 `$.http.变量`
* 绑定计算规则: 可以对传入的 头的值 进行进一步处理。但因为无法将处理的值传出，所以可以使用 [变量设置组件](#变量设置组件) 在该节点前将值处理好。

进行上述操作之后，点击 `保存` 即可。

## 高级配置的输入参数
点击 `添加参数` 按钮，下边会出来一行新的值。以下为相关值的解释。  

* 参数id: 指定 `传入参数` 的变量值
* 参数值: 可以填写 `固定值`，也可以使用变量，例如 `$.http.变量`
* 参数类型: 执行变量的类型
* 绑定计算规则: 可以对传入的 `参数值` 进行进一步处理。但因为无法将处理的值传出，所以可以使用 [变量设置组件](#变量设置组件) 在该节点前将值处理好。
* 备注: 相当于该变量的注释

设置完后，点击 `保存` 即可。

## 高级配置的输出变量
点击 `新增输出参数` 按钮，下边会出来一行新的值。以下为相关值的解释。  
**注意**： 该操作是添加的全局变量  

* 参数名: 全局变量的变量名
* 参数值: 可以填写 `固定值`，也可以使用变量，例如 `$.http.变量`。主要可以用做该 请求API响应值 的设置。

## 节点总结  
可以用作流程内部 API 的请求，可以方便的进行不同接口之间的对接。  

-------------------------

# 结果数据裁剪组件
## 基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称

* 裁剪数据  
用于指定 `需要裁剪的数据范围` ，相应解释如下  
    * 对流程的最终输出结果数据进行裁剪: 可以对 所有节点 和 上一节点 都进行读取和操作，结果可供 下一节点 和 最后响应 使用。
    * 仅对上一节点输出结果进行裁剪..: 只能对 上一节点 进行操作，且结果只能供 下一结果 使用。

* 调试  
指定 是否输出裁剪前和裁剪后 的数据

## 裁剪配置
点击 `添加字段` ，下边会出来一行新的值。以下为相关值的解释。  

* 字段ID: 后边 indoc 中使用的变量名
* 字段值: 可以使用 `$.变量` 的形式，也可以使用 `固定值`。
* 裁剪操作: 选择 `赋值` ，则此处添加的变量可供后边节点使用；选择 `删除` ，则后边节点无法使用该值

## 裁剪规则
使用 javascript 语法进行相关数据的裁剪。相关代码使用方式可以参考javascript脚本中的 [裁剪规则](/scripts/javascript#裁剪规则)。  
可以与 [裁剪配置](#裁剪配置) 同时使用。  

## 节点总结
该节点主要用于对于各个节点已经产生的数据进行组装，用 `裁剪配置` 比较方便，用 `裁剪规则` 更灵活。 

-------------------------

# Shell脚本组件
## 基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称

* 输出结果  
设置为 `不输出转换结果` ，那么该结果不会在最后的响应体中输出，仅供后边节点使用。  
设置为 `输出转换结果给调用端` ，那么该结果会在最后的响应体中输出。  

## Shell脚本
* 结果保存  
Shell 脚本输出的结果会放到这个变量中，可供后边的节点使用。

* 切换工作目录  
指定 Shell命令 执行的开始目录

* Shell脚本  
参见 [Shell脚本](/scripts/Shell#脚本用法) 。

## 节点总结
不好用，建议用 `Python脚本组件` 代替。

-------------------------

# Python脚本组件
## 基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称

* 输出结果  
设置为 `不输出Python执行结果` ，那么该结果不会在最后的响应体中输出，仅供后边节点使用。  
设置为 `输出Python执行结果给调用端` ，那么该结果会在最后的响应体中输出。  

* Python命令  
输入 RestCloud 服务器中可用的 Python 命令。  
如： `python3`不可用，`python`可用，就填入 `python`  

* 输入参数  
需要传递给 `python脚本` 的参数，可以用 `固定值` 和 `变量`（${$.global.变量名} 等）。`变量` 用 `英文逗号` 分割  

## Python脚本
参见 [Python脚本](/scripts/python#输入与输出) 。

## 输出参数
点击 `新增输出参数` ，下边会出来一行新的值。以下为相关值的解释。  

* 参数名: 后边 indoc 中使用的变量名
* 参数值: 可以使用 `$.变量` 的形式，也可以使用 `固定值`。`$.变量` 获取的是脚本中 `print()` 函数输出的结果。

点击保存即可。

## 节点总结
该脚本可作为 `Shell脚本` 的替代品，但注意脚本传入数据有长度限制（因为相当于是命令行中传入），所以不可传入数据太长。  

-------------------------

# SQL脚本组件
## 基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称

* 指定数据源  
用于指定从哪个数据库来源进行数据操作  

* 输出结果  
设置为 `不输出SQL执行结果` ，那么该结果不会在最后的响应体中输出，仅供后边节点使用。  
设置为 `输出SQL执行结果给调用端` ，那么该结果会在最后的响应体中输出。  

* 运行方式  
`仅执行一次` 用于只传入了一个 json 的情况，直接在 SQL 中使用传入 json 的参数即可。  
`对输入的JSON数组逐行执行SQL` 用于传入了一个 json数组 的情况，需要指定 `JSON数据路径` ，且执行过程中，无法使用除 传入json 外的其他变量，如 `$.global.myTestVar`。  

* SQL执行选项  
用于指定执行 `查询` 还是 `修改` 或者 `批量` 的操作。以下为相关解释。  
    * 查询: 选择该项可以返回 任意结果集 。可以执行插入操作，并返回 插入后 的 插入主键。
    * 修改: 选择该项只能返回 数字 ，无法返回其他类型的 数据（如 插入后 无法返回 插入主键）。可放多条 SQL。
    * 批量: 可以放多条 增删改 的 SQL 。无法返回 SQL执行 结果。  

* 数据流选项  
    * 替换当前数据流: 仅把 indoc 的数据流全部换为 数据库执行结果 。不影响 全局变量 等其他变量。
    * 追加到indoc.data数据流中: 不仅 数据库执行结果 在 indoc 中，且 全局变量 会追加到 indoc 里
    * 追加到indoc变量中: 数据可能会有问题，不建议使用
    * 追加到全局变量中: 可能会报错，不建议使用
    * 追加到指定字段中: 数据库执行结果 会在 indoc 中的指定字段添加，且丢失 total 字段。全局变量 会追加到 indoc 里。

## SQL语句
参见 [SQL脚本](/scripts/sql#语句写法) 。

## 输出参数
点击 `新增输出参数` ，下边会出来一行新的值。以下为相关值的解释。  

* 参数名: 后边 indoc 中使用的变量名
* 参数值: 可以使用 `$.变量` 的形式，也可以使用 `固定值`。对于 查询 出来的值，最外层一般是 `total` 和 `data` 两个字段。

点击保存即可。

## 节点总结
当需要用传入的数据直接更新数据库，或者进行复杂数据的查询时，用这个节点会很有用

-------------------------

# JS脚本组件
## 基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称

* 输出结果  
设置为 `不输出API结果` ，那么该结果不会在最后的响应体中输出，仅供后边节点使用。  
设置为 `输出API结果给调用端` ，那么该结果会在最后的响应体中输出。  

## JS代码
参见 [javascript脚本](/scripts/javascript#JS脚本) 。

## 节点总结
该节点主要用于 `传入数据的处理` 以及 `数据的传出`。  
可以实现的功能较多。  
但不支持使用 `nodejs` 的相关依赖包。    

-------------------------

# Java脚本组件
## 基本属性
* 节点名称  
相当于是给该节点加的 `注释`，建议起一个有意义的名称

* 输出结果  
设置为 `不输出API结果` ，那么该结果不会在最后的响应体中输出，仅供后边节点使用。  
设置为 `输出API结果给调用端` ，那么该结果会在最后的响应体中输出。  

## Java代码
相关代码编写 参见 [java脚本](/scripts/java#Java脚本) 。  
**注意写完代码之后点击 `保存` ，然后点击 `编译`**  

## 节点总结
该节点主要用于 `传入数据的处理` 以及 `数据的传出`。  
可以实现的功能较多。  
可以使用相关 `java` 依赖包。  

-------------------------

上次修改时间: {docsify-updated}
